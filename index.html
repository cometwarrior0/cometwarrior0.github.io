<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.5.2/jscolor.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400..900&family=Zain:ital,wght@0,200;0,300;0,400;0,700;0,800;0,900;1,300;1,400&display=swap"
      rel="stylesheet"
    />
    <style type="text/css">
      @layer base {
        img {
          @apply iiiiiiiiiiiiiiinline-block;
        }
        body {
          font-family: Gabarito;
        }
      }
    </style>
  </head>

  <body id="body" class="p-8 flex h-screen flex-col dark:bg-gray-800">
    <div id="tier-list"></div>
    <div id="add-tier"></div>
    <div
      id="item-list"
      class="flex min-h-[64px] grow flex-wrap justify-center md:min-h-[96px] lg:min-h-[128px]"
    ></div>

    <script>
      function setWidth(thediv, size) {
        thediv.style.width = Math.floor(window.innerWidth / size) * size + "px";
      }

      // Create a global ID counter so every element has unique ID
      var generateID = (function () {
        var globalIdCounter = 0;
        return function (baseStr) {
          return baseStr + globalIdCounter++;
        };
      })();

      // Create an array of pre-made tiers to be sorted
      var tiers = [
        ["S", "#BF7FFF"],
        ["A", "#00BFFF"],
        ["B", "#7FFF3F"],
        ["C", "#FFFF3F"],
        ["D", "#FF4F4F"],
      ];

      // Get the container element for the tier list
      var container = document.getElementById("tier-list");
      var itemContainer = document.getElementById("item-list");

      // Create the pre-made tiers from the array
      for (tier of tiers) {
        createTier(tier[0], tier[1]);
      }

      // Create a function to create tiers
      function createTier(tierName = "New Tier", tierColor = "#d0d0ff") {
        // Create a box to put elements into
        var box = document.createElement("div");
        container.append(box);
        box.className = "relative flex flex-row";
        box.id = generateID("box-id-");

        // Create a header element for the tier name
        var header = document.createElement("div");
        header.className = "m-0.5 flex flex-none lg:w-[128px] md:w-[96px] w-[64px]]";
        box.append(header);

        var headerText = document.createElement("div");
        headerText.textContent = tierName;
        headerText.className =
          "lg:text-2xl md:text-lg text-xs flex grow text-center items-center justify-center";
        headerText.contentEditable = "True";
        header.append(headerText);

        // Create box where items can be dragged
        var list = document.createElement("div");
        box.append(list);
        list.className =
          "m-0.5 flex flex-row grow flex-wrap content-start lg:min-h-[128px] md:min-h-[96px] min-h-[64px] bg-[#0000003f]";

        // Create a handle
        var handle = document.createElement("div");
        handle.textContent = "⥮";
        handle.className =
          "opacity-0 hover:opacity-100 text-[16px] md:text-[24px] lg:text-[32px] text-center z-20 left-0 handle h-full lg:w-6 md:w-4.5 w-3 absolute items-center justify-center cursor-row-resize flex";
        box.append(handle);

        // Create a remove button
        var remove = document.createElement("div");
        handle.append(remove);
        remove.textContent = "-";
        remove.className =
          "cursor-pointer select-none flex text-[16px] md:text-[24px] lg:text-[32px] items-center justify-center z-30 left-0 bottom-0 absolute lg:max-h-6 md:max-h-4.5 max-h-3 lg:w-6 md:w-4.5 w-3";

        remove.onclick = function(){
          while(list.hasChildNodes()){
            itemContainer.append(list.firstChild);
          }
          box.remove();
        }
        
        // Create a color picker
        var cogwheel = document.createElement("div");
        handle.append(cogwheel);
        cogwheel.textContent = "✱";
        cogwheel.className =
          "cursor-pointer select-none flex text-[10px] md:text-[15px] lg:text-[20px] justify-center z-30 left-0 top-0 absolute lg:max-h-6 md:max-h-4.5 max-h-3 lg:w-6 md:w-4.5 w-3";

        let opts = {
          backgroundColor: "#333",
          previewElement: "#" + box.id,
          value: tierColor,
        };
        let picker = new JSColor(cogwheel, opts);

        // Make the list sortable using SortableJS
        Sortable.create(list, {
          animation: 150,
          group: "item",
        });
        return box;
      }

      var addButton = document.getElementById("add-tier");
      addButton.textContent = "+";
      addButton.className =
        "mx-[25%] my-2 text-[16px] md:text-[24px] lg:text-[32px] cursor-cell select-none justify-center items-center bg-gray-600 flex";
      addButton.onclick = function () {
        createTier();
      };

      // Make the tiers sortable using SortableJS
      Sortable.create(container, {
        animation: 150,
        group: "tier",
        handle: ".handle",
        direction: "horizontal",
      });

      fetch("https://ddragon.leagueoflegends.com/api/versions.json")
        .then((res) => res.json())
        .then((data) => {
          let version = data[0];
          fetch(
            "https://ddragon.leagueoflegends.com/cdn/" +
              version +
              "/data/en_US/champion.json",
          )
            .then((res) => res.json())
            .then((data) => {
              for (champ of Object.keys(data.data).map(
                (key) => data.data[key].id,
              )) {
                var item = document.createElement("img");
                item.className =
                  "flex lg:max-w-[128px] md:max-w-[96px] max-w-[64px] z-10 cursor-move";
                item.src =
                  "https://ddragon.leagueoflegends.com/cdn/" +
                  version +
                  "/img/champion/" +
                  champ +
                  ".png";
                itemContainer.append(item);
              }
            });
        });

      Sortable.create(itemContainer, {
        animation: 150,
        group: "item",
      });
    </script>
  </body>
</html>
